<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pricelist Topup â€” OpenRouter Style</title>
  <meta name="description" content="Pricelist terhubung Google Sheets, dengan header Sign in ala OpenRouter.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <style>
    /* ======= Design tokens (OpenRouter-ish, airy, light) ======= */
    :root{
      --bg:#f7f8fb;         /* page background */
      --paper:#ffffff;      /* surfaces */
      --text:#0b1220;       /* primary text */
      --muted:#5b667a;      /* secondary text */
      --border:#e6eaf2;     /* soft border */
      --ring:#cfd8ff;       /* focus ring */
      --brand:#675CFF;      /* accent (subtle) */
      --maxw:1120px; 
      --radius:14px;
      --shadow-1:0 1px 2px rgba(9,30,66,.08);
      --shadow-2:0 14px 38px rgba(9,30,66,.12);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0f1422; --paper:#121a2b; --text:#eef2f7; --muted:#9aa4b2; --border:#27344a; --ring:#314266; 
        --shadow-1:0 1px 2px rgba(0,0,0,.35);
        --shadow-2:0 16px 44px rgba(0,0,0,.45);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font: 15.5px/1.6 Inter, ui-sans-serif, -apple-system, system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit; text-decoration:none}

    /* ======= Topbar ala OpenRouter ======= */
    .topbar{
      position:sticky; top:0; z-index:50;
      background: color-mix(in oklab, var(--bg) 70%, transparent);
      backdrop-filter: blur(10px) saturate(160%);
      border-bottom:1px solid var(--border);
    }
    .topbar .inner{
      max-width:var(--maxw); margin:0 auto; padding:10px 16px;
      display:flex; align-items:center; gap:10px;
    }
    .brand{display:flex; align-items:center; gap:10px}
    .logo{
      width:28px; height:28px; border-radius:8px;
      background: radial-gradient(100% 100% at 20% 10%, #91a4ff, #675CFF 70%);
      box-shadow:var(--shadow-1);
    }
    .brand span{font:700 19px/1 Poppins, Inter, ui-sans-serif; letter-spacing:.1px}

    .grow{flex:1}
    .actions{display:flex; align-items:center; gap:8px}

    /* pill buttons (Sign in & menu) */
    .pill{
      padding:9px 14px; border-radius:999px; font-weight:600; font-size:14.5px;
      background:#fff; color:#1f2937; border:1px solid #e5e7eb;
      box-shadow: 0 1px 0 #fff, 0 10px 26px rgba(0,0,0,.08);
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    @media (prefers-color-scheme: dark){
      .pill{ background:#ffffff; color:#0b1220; border-color:#e9eef5;
             box-shadow: 0 1px 0 #fff, 0 10px 26px rgba(0,0,0,.24); }
    }
    .pill:hover{ transform:translateY(-1px); box-shadow:0 16px 36px rgba(0,0,0,.12); }
    .icon-btn{
      width:40px; height:40px; display:grid; place-items:center;
      border-radius:999px; border:1px solid #e5e7eb; background:#fff; color:#111827;
      box-shadow: 0 1px 0 #fff, 0 10px 26px rgba(0,0,0,.08);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .icon-btn:hover{ transform:translateY(-1px); box-shadow:0 16px 36px rgba(0,0,0,.12); }
    .hamburger, .hamburger::before, .hamburger::after{
      content:""; display:block; width:18px; height:2px; background:currentColor; border-radius:2px; position:relative;
    }
    .hamburger::before{ position:absolute; top:-6px }
    .hamburger::after{ position:absolute; top:6px }
    .avatar{
      width:40px; height:40px; border-radius:999px; display:grid; place-items:center; font-weight:800;
      background:#fff; color:#111827; border:1px solid #e5e7eb; box-shadow:0 1px 0 #fff, 0 10px 26px rgba(0,0,0,.08);
    }

    /* ======= Page layout ======= */
    .wrap{max-width:var(--maxw); margin:0 auto; padding:22px 16px 40px}
    header h1{margin:6px 0 4px; font:700 clamp(22px,3.2vw,30px)/1.15 Poppins, Inter, sans-serif; letter-spacing:-.2px}
    header p{margin:0; color:var(--muted); font-size:14.5px}

    /* search + tabs */
    .tools{display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin:16px 0 18px}
    .search-wrap{position:relative; flex:1 1 280px}
    .search-wrap svg{position:absolute; left:12px; top:50%; transform:translateY(-50%); width:18px; height:18px; color:var(--muted)}
    input[type="search"]{
      width:100%; padding:12px 12px 12px 40px; border-radius:12px; font-size:14.5px;
      background:var(--paper); color:var(--text); border:1px solid var(--border);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
    }
    input[type="search"]:focus-visible{ outline:2px solid var(--ring); outline-offset:2px }

    .info{color:var(--muted); font-size:13.5px; font-weight:600}

    .tabs{
      display:flex; gap:8px; overflow:auto; padding:8px 0 10px; margin:10px 0 6px;
      border-bottom:1px solid var(--border); position:sticky; top:64px; background:var(--bg); z-index:40;
    }
    .tab{
      padding:10px 14px; border-radius:999px; background:var(--paper); color:var(--muted);
      border:1px solid var(--border); font-weight:700; font-size:13.8px; white-space:nowrap; box-shadow:var(--shadow-1);
      transition: transform .15s ease, box-shadow .15s ease, color .15s ease, border-color .15s ease;
    }
    .tab:hover{ transform:translateY(-1px); color:var(--text) }
    .tab[aria-selected="true"]{ color:#111827; background:#fff; border-color:#dfe4ee; box-shadow:0 14px 36px rgba(0,0,0,.08) }

    /* grid & card */
    .grid{display:grid; gap:14px; grid-template-columns:repeat(auto-fill, minmax(180px, 1fr))}
    .card-link{
      display:block; text-decoration:none; color:inherit; background:var(--paper);
      border:1px solid var(--border); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow-1);
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .card-link:hover{ transform:translateY(-2px); box-shadow:var(--shadow-2); border-color:#dfe4ee }
    .card{display:flex; flex-direction:column; text-align:center}
    .card h3{margin:0; font:700 14.5px/1.35 Inter, sans-serif; letter-spacing:.08px}
    .price{margin-top:10px; font-weight:800; font-size:18px; color:#3b82f6}

    /* empty & error */
    .empty,.err{
      grid-column:1 / -1; text-align:center; padding:44px 20px; border-radius:16px; border:1px dashed var(--border);
      background:var(--paper); color:var(--muted)
    }
    .err{ border:1px solid #ef4444; background:#fff1f1; color:#a40000; display:none }
    @media (prefers-color-scheme: dark){ .err{ background:#2a0c0c; color:#ffb4b4 } }

    /* drawer & modal */
    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.35); opacity:0; pointer-events:none; transition:opacity .2s ease; z-index:60 }
    .overlay.show{ opacity:1; pointer-events:auto }
    .drawer{
      position:fixed; right:0; top:0; height:100dvh; width:min(86vw,360px); background:var(--paper); color:var(--text);
      border-left:1px solid var(--border); transform:translateX(100%); transition:transform .25s ease; z-index:70; padding:18px
    }
    .drawer.show{ transform:translateX(0) }
    .drawer h3{ margin:4px 0 14px; font:700 16px/1.1 Poppins, Inter, sans-serif }
    .drawer a{ display:block; padding:10px 10px; border-radius:10px; border:1px solid var(--border); margin-bottom:8px }

    .modal{ position:fixed; inset:0; display:grid; place-items:center; z-index:80; pointer-events:none }
    .modal .card{
      width:min(520px, 92vw); padding:18px; background:var(--paper); border:1px solid var(--border); border-radius:18px;
      box-shadow:var(--shadow-2); transform:translateY(12px); opacity:0; transition:transform .2s ease, opacity .2s ease
    }
    .modal.show{ pointer-events:auto }
    .modal.show .card{ transform:translateY(0); opacity:1 }
    .modal h2{ margin:0 0 8px; font:700 20px/1.2 Poppins, Inter, sans-serif }
    .modal p{ margin:0 0 14px; color:var(--muted) }
    .row{ display:flex; gap:10px; align-items:center }
    .modal input{
      flex:1; padding:10px 12px; border-radius:12px; background:var(--paper); color:var(--text); border:1px solid var(--border)
    }
    .btn-primary{ padding:10px 14px; border-radius:12px; border:1px solid transparent; color:#fff; background:linear-gradient(135deg,#7b8cff,#675CFF); font-weight:700; cursor:pointer; box-shadow:var(--shadow-2) }
    .btn-ghost{ padding:10px 12px; border-radius:12px; background:transparent; border:1px solid var(--border); cursor:pointer }
  </style>
</head>
<body>
  <!-- ======= TOPBAR ======= -->
  <div class="topbar">
    <div class="inner">
      <a class="brand" href="#"><span class="logo" aria-hidden="true"></span><span>PlayPal</span></a>
      <div class="grow"></div>
      <div class="actions">
        <button class="icon-btn" id="searchToggle" aria-label="Cari">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg>
        </button>
        <button id="signinBtn" class="pill">Sign in</button>
        <button class="icon-btn" id="menuBtn" aria-label="Menu"><span class="hamburger"></span></button>
      </div>
    </div>
  </div>

  <!-- ======= CONTENT ======= -->
  <main class="wrap">
    <header>
      <h1>Pricelist Topup</h1>
      <p>Pilih game, cari paket, lalu klik untuk order via WhatsApp.</p>
    </header>

    <nav id="tabs" class="tabs" role="tablist" aria-label="Game"></nav>

    <div class="tools">
      <div class="search-wrap" id="searchWrap">
        <svg aria-hidden="true" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg>
        <input id="search" type="search" placeholder="Cari item..." aria-label="Cari" autocomplete="off">
      </div>
      <span id="countInfo" class="info" aria-live="polite"></span>
    </div>

    <section id="grid" class="grid" aria-live="polite"></section>
    <section id="error" class="err" role="alert"></section>

    <template id="cardTmpl">
      <a class="card-link" target="_blank" rel="noopener">
        <article class="card">
          <h3 class="title"></h3>
          <div class="price"></div>
        </article>
      </a>
    </template>
  </main>

  <!-- Drawer & overlay -->
  <div id="overlay" class="overlay" aria-hidden="true"></div>
  <aside id="drawer" class="drawer" aria-hidden="true" aria-label="Menu">
    <h3>Menu</h3>
    <a href="#">Beranda</a>
    <a href="#">Semua Game</a>
    <a href="#">Lacak Pesanan</a>
    <a href="#">Bantuan</a>
  </aside>

  <!-- Modal Sign in -->
  <div id="signinModal" class="modal" aria-hidden="true">
    <div class="card">
      <h2>Masuk</h2>
      <p>Demo sederhana. Masukkan email untuk menyimpan sesi lokal.</p>
      <div class="row">
        <input id="emailInput" type="email" placeholder="you@example.com" autocomplete="email">
        <button id="doSignIn" class="btn-primary">Lanjut</button>
        <button id="closeSignIn" class="btn-ghost">Tutup</button>
      </div>
    </div>
  </div>

  <script>
    /* ======= KONFIG ======= */
    const SHEET_ID   = '1B0XPR4uSvRzy9LfzWDjNjwAyMZVtJs6_Kk_r2fh7dTw';
    const SHEET_NAME = 'Sheet3';
    const SHEET_JSON_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json`;
    const WA_NUMBER   = '6285877001999';
    const WA_GREETING = 'Halo, saya mau order:';

    /* ======= UTIL ======= */
    const $ = s => document.querySelector(s);
    function toIDR(v){ return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(v); }
    function prettyLabel(s){ return String(s||'').trim().replace(/\s+/g,' '); }
    function makeKode(catKey, title){
      const num = (String(title).match(/\d+/) || [''])[0];
      const base = (catKey||'game').toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-]/g,'');
      return `${base}${num?num:''}`;
    }

    const tabsEl = $('#tabs'), gridEl = $('#grid'), searchEl = $('#search'), countInfoEl = $('#countInfo'),
          cardTmpl = $('#cardTmpl'), errBox = $('#error');

    let DATA = [], CATS = [], activeCat = '', query = '';

    function parseGVizPairs(jsonText){
      const m = jsonText.match(/\{.*\}/s);
      if(!m) throw new Error('Response GViz tidak valid.');
      const obj = JSON.parse(m[0]);
      const {rows=[], cols=[]} = obj.table || {};
      const pairs = [];
      for(let i=0; i<cols.length; i+=2){
        const label = cols[i]?.label || '';
        if(label && cols[i+1]) pairs.push({ iTitle:i, iPrice:i+1, label });
      }
      const out = [];
      for(const r of rows){
        const c = r.c || [];
        for(const p of pairs){
          const title = c[p.iTitle]?.v != null ? String(c[p.iTitle].v).trim() : '';
          const priceRaw = c[p.iPrice]?.v;
          const price = priceRaw!=null && priceRaw!=='' ? Number(priceRaw) : NaN;
          if(title && !isNaN(price)){
            out.push({ catKey:p.label, catLabel:prettyLabel(p.label), title, price, kode:makeKode(p.label, title) });
          }
        }
      }
      return out;
    }

    function buildTabs(){
      const map = new Map();
      DATA.forEach(it => { if(!map.has(it.catKey)) map.set(it.catKey, it.catLabel) });
      CATS = [...map].map(([key,label]) => ({key,label}));

      tabsEl.innerHTML = '';
      CATS.forEach((c, idx)=>{
        const b = document.createElement('button');
        b.className = 'tab'; b.type = 'button'; b.role = 'tab';
        b.setAttribute('aria-selected', idx===0 ? 'true':'false');
        b.dataset.cat = c.key; b.textContent = c.label;
        b.onclick = () => {
          const prev = tabsEl.querySelector('[aria-selected="true"]');
          if(prev) prev.setAttribute('aria-selected','false');
          b.setAttribute('aria-selected','true');
          activeCat = c.key; renderGrid();
        };
        tabsEl.appendChild(b);
      });
      activeCat = CATS[0]?.key || '';
    }

    function renderGrid(){
      const q = query.toLowerCase();
      const items = DATA.filter(x => x.catKey===activeCat && (q==='' || x.title.toLowerCase().includes(q) || String(x.price).includes(q)));
      gridEl.innerHTML = '';
      if(items.length===0){ gridEl.innerHTML = `<div class="empty">Tidak ada hasil untuk kategori ini.</div>`; countInfoEl.textContent=''; return; }

      const frag = document.createDocumentFragment();
      for(const it of items){
        const clone = cardTmpl.content.cloneNode(true);
        const link = clone.querySelector('.card-link');
        clone.querySelector('.title').textContent = it.title;
        clone.querySelector('.price').textContent = toIDR(it.price);
        const text = `${WA_GREETING}\n- Game: ${it.catLabel}\n- Item: ${it.title}\n- Harga: ${toIDR(it.price)}`;
        link.href = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(text)}`;
        frag.appendChild(clone);
      }
      gridEl.appendChild(frag);
      countInfoEl.textContent = `${items.length} item`;
    }

    let debounceTimer;
    searchEl.addEventListener('input', e=>{
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(()=>{ query = e.target.value.trim(); renderGrid(); }, 140);
    });

    async function load(){
      try{
        const res = await fetch(SHEET_JSON_URL, {cache:'no-store'});
        const txt = await res.text();
        DATA = parseGVizPairs(txt);
        if(DATA.length===0) throw new Error('Data kosong atau format kolom tidak sesuai (harus Title & Price berpasangan).');
        buildTabs(); renderGrid();
      }catch(err){
        errBox.style.display='block';
        errBox.textContent = `Gagal memuat data: ${err.message}`;
      }
    }
    load();

    /* ======= Header interactions (OpenRouter-like) ======= */
    const drawer = document.getElementById('drawer');
    const overlay = document.getElementById('overlay');
    const menuBtn = document.getElementById('menuBtn');
    const signinBtn = document.getElementById('signinBtn');
    const modal = document.getElementById('signinModal');
    const emailInput = document.getElementById('emailInput');

    function openDrawer(){ drawer.classList.add('show'); overlay.classList.add('show'); drawer.setAttribute('aria-hidden','false'); }
    function closeDrawer(){ drawer.classList.remove('show'); overlay.classList.remove('show'); drawer.setAttribute('aria-hidden','true'); }

    menuBtn.addEventListener('click', openDrawer);
    overlay.addEventListener('click', ()=>{ closeDrawer(); closeModal(); });

    function openModal(){ modal.classList.add('show'); overlay.classList.add('show'); modal.setAttribute('aria-hidden','false'); emailInput.focus(); }
    function closeModal(){ modal.classList.remove('show'); overlay.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }

    document.getElementById('closeSignIn').addEventListener('click', closeModal);
    document.getElementById('searchToggle').addEventListener('click', ()=>{
      document.getElementById('searchWrap').scrollIntoView({behavior:'smooth', block:'center'});
      document.getElementById('search').focus();
    });

    function setLoggedIn(email){
      localStorage.setItem('pp_user', JSON.stringify({email}));
      const initials = (email.split('@')[0].slice(0,2) || 'PP').toUpperCase();
      const avatar = document.createElement('button');
      avatar.className = 'avatar'; avatar.title = email; avatar.textContent = initials;
      signinBtn.replaceWith(avatar);
      avatar.addEventListener('click', ()=>{
        if(confirm(`Keluar dari ${email}?`)){ localStorage.removeItem('pp_user'); location.reload(); }
      });
    }
    function restoreSession(){
      const raw = localStorage.getItem('pp_user');
      if(!raw) return;
      try{ const {email} = JSON.parse(raw)||{}; if(email) setLoggedIn(email); }catch{}
    }
    restoreSession();

    signinBtn.addEventListener('click', openModal);
    document.getElementById('doSignIn').addEventListener('click', ()=>{
      const email = (emailInput.value||'').trim();
      if(!/^\S+@\S+\.\S+$/.test(email)){ emailInput.focus(); emailInput.select(); return; }
      setLoggedIn(email); closeModal();
    });

    window.addEventListener('keydown', e=>{ if(e.key==='Escape'){ closeDrawer(); closeModal(); }});
  </script>
</body>
</html>
    
